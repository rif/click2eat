{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ object.name }}{% endblock%}

{% block style %}
<link type="text/css" href="{{MEDIA_URL}}css/jquery.ui.all.css" rel="stylesheet" />
<style type="text/css">
        h4 { padding: .2em; margin: 0; }
        #menu { float:left; width: 500px; margin-right: 2em; }
        .cart { width: 200px; float: left; margin:10px;}
        /* style the list to maximize the droppable hitarea */
        .cart ol { margin: 0; padding: 1em 0 1em 3em; }
        </style>
{% endblock %}

{% block scripts %}
        <script type="text/javascript" src="{{MEDIA_URL}}js/ui/jquery.ui.core.js"></script>
        <script type="text/javascript" src="{{MEDIA_URL}}js/ui/jquery.ui.widget.js"></script>
        <script type="text/javascript" src="{{MEDIA_URL}}js/ui/jquery.ui.mouse.js"></script>
        <script type="text/javascript" src="{{MEDIA_URL}}js/ui/jquery.ui.draggable.js"></script>
        <script type="text/javascript" src="{{MEDIA_URL}}js/ui/jquery.ui.droppable.js"></script>
<script type="text/javascript">

  $(function(){
    $("#current-order").load("{% url order:get_current object.id %}");
    $(".add-item").click(function(e){
      $.get("/order/add_item/" + $(this).parent("li").attr("id") + "/{{ user.username }}" , function(response){
          $("#current-order").load("{% url order:get_current object.id %}")
        });
        e.preventDefault();
    });
                $("#menu li").draggable({
                        appendTo: "body",
                        helper: "clone"
                });
    $("#add-cart").click(function(e){
      $.get("{% url order:add_cart object.id %}", function(data){
          $("#carts").append(data);
        });
      e.preventDefault();
    });
    $("#last-orders").load("{% url order:list_unit object.id %}", function(){
      pageLinks();
    });
    $(".toggle-toppings").click(function(e){
        $(this).next().slideToggle();
        e.preventDefault();
    });
  });
  function pageLinks(){
    $(".page-link").click(function(e){
        $.get("{% url order:list_unit object.id %}"+ $(this).attr("href"), function(data){
          $("#last-orders").html(data);
          pageLinks();
        });
        e.preventDefault();
      });
  }
</script>
{% endblock %}

{% block content %}
<img src="{{ object.logo_path }}" alt="logo" />
<h1>{{ object.name }}{% trans ' details' %}</h1>

<ul>
<li>{% trans 'Name' %}: {{ object.name }}</li>
<li>{% trans 'Address' %}: {{ object.address }}</li>
<li>{% trans 'Email' %}: {{ object.email }}</li>
<li>{% trans 'Phone' %}: {{ object.phone }}</li>
<li>{% trans 'Open hours' %}: {{ object.schedule }}, {% trans 'Open'%}: {{ object.schedule.is_open|yesno }}</li>
{% if object.info %}<li>{% trans 'Info' %}: {{ object.info|safe}}</li>{% endif %}
</ul>

<h2>{% trans 'Previous orders at this restaurant' %}</h2>
<div id="last-orders">
</div>

<br>

<h2>{% trans 'Current order' %}</h2>
<div id="current-order">
</div>
<a {% if not object.schedule.is_open %}class="closed-unit"{% endif %} href="{% url order:send object.id %}">{% trans 'Send' %}</a>
  
<h1 class="ui-widget-header">{% trans 'Menu' %}</h1>
<ul id="menu">
{% for itemgroup in object.itemgroup_set.iterator %}
{% if itemgroup.active %}
  <h3>{{ itemgroup }}</h3>
  {% for item in itemgroup.item_set.iterator %}
  {% if item.active %}
    <li id="{{ item.id }}"><a href="#" class="add-item">{{ item.name_ro }}</a> - <span class="item-desc">{{item.description_ro}}</span><br/>
    {{ item.name_en }} - <span class="item-desc">{{item.description_en}}</span></li>
    {% if item.toppings %}
    <a class="toggle-toppings" href="#" title="{% trans 'Toggle toppings' %}">+</a>
    <span class="topping-span" style="display:none">
    {% trans 'Toppings' %}:
    <ul>
      {% for top in item.toppings.topping_set.iterator %}
      <li id="{{ top.id }}"><a href="#" class="add-item">{{ top.name_ro }}</a> - <span class="item-desc">{{top.description_ro}}</span><br/>
    {{ top.name_en }} - <span class="item-desc">{{top.description_en}}</span></li>
      {% endfor %}
    </ul>  
    </span>
    {% endif %}
  {% endif %}
    {% empty %}
    <li>{% trans 'No items in this group' %}</li>
  {% endfor %}
{% endif %}
{% endfor %}
</ul>
<div id="carts">
{% for cartname, oil in carts.items %}

{% include 'order/order_cart.html' %}

{% empty %}
{% with user.username as cartname %}
  {% include 'order/order_cart.html' %}
{% endwith %}

{% endfor %}
</div>
<a id="add-cart" href="#">{% trans 'Add cart' %}</a>
<br>
<a href="{% url restaurant:index %}">{% trans 'Home' %}</a>
{% endblock %}
