{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ object.name }}{% endblock%}

{% block style %}
<link type="text/css" href="{{MEDIA_URL}}css/jquery.ui.all.css" rel="stylesheet" />
<style type="text/css">
        h4 { padding: .2em; margin: 0; }
        #menu { float:left; width: 500px; margin-right: 2em; }
        .cart { width: 200px; float: left; margin:10px;}
        /* style the list to maximize the droppable hitarea */
        .cart ol { margin: 0; padding: 1em 0 1em 3em; }
        </style>
{% endblock %}

{% block scripts %}
        <script type="text/javascript" src="{{MEDIA_URL}}js/ui/jquery.ui.core.js"></script>
        <script type="text/javascript" src="{{MEDIA_URL}}js/ui/jquery.ui.widget.js"></script>
        <script type="text/javascript" src="{{MEDIA_URL}}js/ui/jquery.ui.mouse.js"></script>
        <script type="text/javascript" src="{{MEDIA_URL}}js/ui/jquery.ui.draggable.js"></script>
        <script type="text/javascript" src="{{MEDIA_URL}}js/ui/jquery.ui.droppable.js"></script>
<script type="text/javascript">

  $(function(){
    $("#current-order").load("{% url order:get_current object.id %}");
    $(".add-item").click(function(e){
      $.get("/order/add_item/" + $(this).parent("li").attr("id"), function(response){
          $("#current-order").load("{% url order:get_current object.id %}");
        });
        e.preventDefault();
    });
                $("#menu li").draggable({
                        appendTo: "body",
                        helper: "clone"
                });
                $(".cart ol").droppable({
                        activeClass: "ui-state-default",
                        hoverClass: "ui-state-hover",
                        drop: function(event, ui) {
                                $(this).find(".placeholder").remove();
                                var $cart_id = $(this).parents(".cart").attr("id");
                                var $item_id = ui.draggable.attr("id");
                                $("<li></li>").text(ui.draggable.text()).appendTo(this);
                                $.get("/order/add_item/" + $item_id + "/" + $cart_id + "/", function(response){
                                    $("#current-order").load("{% url order:get_current object.id %}");
                                });
                        }
                });
    $("#add-cart").click(function(e){
      $.get("{% url order:add_cart object.id %}", function(data){
          $("#carts").append(data);
        });
      e.preventDefault();
    });
  });

</script>
{% endblock %}

{% block content %}
<img src="{{ object.logo_path }}" alt="logo" />
<h1>{{ object.name }}{% trans ' details' %}</h1>

<ul>
<li>{% trans 'Name' %}: {{ object.name }}</li>
<li>{% trans 'Address' %}: {{ object.address }}</li>
<li>{% trans 'Email' %}: {{ object.email }}</li>
<li>{% trans 'Phone' %}: {{ object.phone }}</li>
</ul>

<h2>Current order:</h2>
<div id="current-order">
</div>

<h1>{% trans 'Menu' %}</h1>
<h2 class="ui-widget-header">{% trans 'Special Items' %}</h2>
<ul>
{% for sitem in object.specialitem_set.iterator %}
<li>{{ sitem }}</li>
{% endfor %}
</ul>

<h2 class="ui-widget-header">{% trans 'Usual items' %}</h2>
<ul id="menu">
{% for item in object.item_set.iterator %}
<li id="{{ item.id }}"><a href="#" class="add-item">{{ item.name_ro }}</a> - <span class="item-desc">{{item.description_ro}}</span><br/>
  {{ item.name_en }} - <span class="item-desc">{{item.description_en}}</span></li>
{% endfor %}
</ul>
<div id="carts">
{% for cart in carts %}

<div class="cart" id="{{ cart }}">
        <h4 class="ui-widget-header">Shopping Cart</h4>
        <div class="ui-widget-content">
                <ol>
                        <li class="placeholder">Add your items here</li>

                </ol>
        </div>
</div>
{% empty %}
<div class="cart" id="{{ user.username }}">
        <h4 class="ui-widget-header">{{ user.username }}</h4>
        <div class="ui-widget-content">
                <ol>
                        <li class="placeholder">Add your items here</li>

                </ol>
        </div>
</div>
{% endfor %}
</div>
<a id="add-cart" href="#">Add cart</a>
<br>
<a href="{% url restaurant:index %}">{% trans 'Home' %}</a>
{% endblock %}
