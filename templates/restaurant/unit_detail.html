{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ object.name }}{% endblock %}

{% block style %}
    <link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/tabs_style.css"/>
{% endblock %}

{% block scripts %}
    <script type="text/javascript">
    $(function() {
	$(".btncomanda").click(function(e) {
	    var selected_cart = $("#sidebar2 .selected-cart");
	     $.get("/order/add_item/" + $(this).attr("id") + "/" + selected_cart.attr("id"), function(response) {
		 $(".cart-content", selected_cart).load("/order/get_cart/{{ order.id }}/" + selected_cart.attr("id"));
		getAvailableToppings();
	    });
	    e.preventDefault();
	});
	$(".add-motd").click(function(e) {
            var selected_cart = $(".current", ".css-tabs").attr("id");
            $.get("/order/add_motd/" + $(this).attr("id") + "/" + selected_cart, function(response) {
                $(".css-panes>div").load("/order/get_cart/{{ order.id }}/" + selected_cart);
                getAvailableToppings();
            });
            e.preventDefault();
        });
        $(".add-topping").click(function(e) {
            var selected_cart = $(".current", ".css-tabs").attr("id");
            $.get("/order/add_topping/" + $(this).attr("href") + "/" + $(this).attr("id") + "/" + selected_cart, function(response) {
                $(".css-panes>div").load("/order/get_cart/{{ order.id }}/" + selected_cart);
                getAvailableToppings();
            });
            e.preventDefault();
        });
        $("#add-cart").click(function(e) {
            if ($("#id_name").length == 0) { // we don't have one already
                $.get("{% url order:add_cart order.id %}", function(data) {
                    /*$("#carts>ul").append(data);
                    $("#id_name").focus();*/
		    console.log(data);
                });
            }
            e.preventDefault();
        });
        $("#last-orders").load("{% url order:list_unit object.id %}", function() {
            pageLinks();
        });
        $(".toggle-toppings").click(function(e) {
            $(this).next().slideToggle();
            e.preventDefault();
        });
        getAvailableToppings();
        $("#show-previous-link").click(function(e) {
            $("#last-orders").toggle();
            e.preventDefault();
        })
    });
function pageLinks() {
    $(".page, .next, .prev").click(function(e) {
        $.get("{% url order:list_unit object.id %}" + $(this).attr("href"), function(data) {
            $("#last-orders").html(data);
            pageLinks();
        });
        e.preventDefault();
    });
}
function getAvailableToppings() {
    $.get("{% url order:available_toppings object.id %}", function(data) {
        var json = eval(data);
        $(".top-span").each(function() {
            if ($.inArray($(this).attr("id"), json.items) != -1) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });
    });
}
function addCartName() {
    $("#cart-name-form").submit(function() {
        var $action = $("#cart-name-form").attr("action");
        $.post($action,
               { csrfmiddlewaretoken:  $("input[name='csrfmiddlewaretoken']").val(),
                 name:                   $("#id_name").val(),
               }, function(data) {
                   var tabs_obj = $("#carts>ul.css-tabs");
                   $("#new-cart").replaceWith(data);
                   tabs_obj.tabs("div.css-panes > div", {effect: 'ajax'});
                   var api = tabs_obj.data("tabs");
                   var tabs_nb = $("li", tabs_obj).size() - 1;
                   api.click(tabs_nb);
               });
        return false;
    });
}
</script>
{% endblock %}

    {% block content %}
    {% if motd %}
    <div class="content_area">
      <div class="title"><h1 class="light_orange">{% trans 'Menu of the day' %}</h1></div>
      <h2><a id="{{ motd.id }}" class="add-motd" href="#">{{ motd.name }}</a></h2>
      {{ motd.description|safe }}
    </div><!-- content_area -->
    {% endif %}
    
    <div class="content_area">
      <div id="paginarestaurant">
        <div class="title"><h1 class="light_green">{{ object.name }}{% trans ' details' %}</h1></div>
        <br/>
        <div id="establishment_details">
          <strong>{% trans 'Name' %}:</strong> {{ object.name }}<br/>
    <strong>{% trans 'Address' %}:</strong> {{ object.address }}<br/>
    <strong>{% trans 'Email' %}:</strong> <a href="mailto:{{ object.email }}">{{ object.email }}</a><br/>
    <strong>{% trans 'Phone' %}:</strong> {{ object.phone }}<br/>
    <strong>{% trans 'Open hours' %}:</strong> {{ object.schedule }}, {% trans 'Open' %}: {{ object.schedule.is_open|yesno }}
    <br/>
    {% if object.info %}<strong>{% trans 'Info' %}:</strong> {{ object.info|safe }}<br/>{% endif %}
</div>
    {% if object.logo_path %}
    <div id="establishment_picture">
    <img height="100" src="{{ MEDIA_URL }}{{ object.logo_path }}" alt="logo"/>
    </div>
    {% endif %}
    <div class="clear"></div>
    <a id="show-previous-link" href="#">{% trans 'Previous orders at this restaurant' %}</a>
    <div class="clear"></div>
    <div id="last-orders" style="display:none"></div>
    <div class="clear"></div>

    <div id="paginarestaurant">
    <div class="title"><h1 class="light_orange">{% trans 'LISTA MENIU' %} {{object.name|upper}}</h1></div>
          <div class="establishment-menu">
            {% for itemgroup in object.itemgroup_set.iterator %}
            {% if itemgroup.active %}
            <div class="category">
              <h3><i><a href="#">{{ itemgroup }}</a></i></h3>   
            </div> <!-- category -->
            {% endif %}
            {% endfor %}
          </div> <!-- estabilshment-menu -->
          <div class="clear"></div>
          <div class="establishment-menu">
            {% for itemgroup in object.itemgroup_set.iterator %}
            {% if itemgroup.active %}
            <ul>
              {% for item in itemgroup.item_set.iterator %}
              {% if item.active %}
              <li class="{% cycle 'even' 'odd' %} item {% if item.is_new %}new-item{% endif %} pozrel">
                <div class="name">{{ item.name_def }}</div>
                <div class="description">{{ item.description_def }}</div>
                <div class="price">
                  {{ item.get_price }} {% trans 'lei' %}
                  <a href="#" id="{{ item.id }}" title="" class="btncomanda">{% trans 'Adauga la comanda'%}</a>
                </div>
                <div class="clear"></div>
              </li>
              <div class="clear"></div>

              <span id="top{{ item.id }}" class="top-span" style="display:none">
                {% if item.toppings %}
                <a class="toggle-toppings" href="#"
                   title="{% trans 'Toggle toppings' %}"><img alt="+" src="{{ MEDIA_URL }}images/template/plate_plus_btn.png" /></a>
                <span class="topping-span" style="display:none">
                  {% trans 'Toppings' %}:
                  <ul>
                    {% for top in item.toppings.topping_set.iterator %}
                    <li>
                      <div class="name"><a id="{{ top.id }}" href="{{ item.id }}"
                                           class="add-topping">{{ top.name_def }}</a>
                      </div>
                      <div class="description">{{ top.description_def }}</div>
                    </li>
                    {% endfor %}
                  </ul>
                </span>
                {% endif %}
              </span>
              {% endif %}
              {% empty %}
              <li>{% trans 'No items in this group' %}</li>
              {% endfor %}
            </ul>
            {% endif %}
            {% cycle '' '' '<div class="clear"></div>' %}
            {% endfor %}
            {% if forloop.counter < 3 %}
				    <div class="clear"></div>
				    {% endif %}
          </div> <!-- estabilshment-menu -->
	</div>
	<br/><br/>
</div><!-- paginarestaurant -->
</div><!-- content_area -->

{% endblock %}

