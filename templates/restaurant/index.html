{% extends "base.html" %}
{% load i18n %}

{% block scripts %}
<script src="{{ MEDIA_URL }}js/jquery.timers.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function(){
        /*$("body").everyTime(1000*60,function(i) { //every 60 seconds
            console.log('tick');
        });*/
        $("#notrated-link").click(function(e){
           $("#notrated-orders").slideToggle();
           e.preventDefault();
        });
    });
</script>
{% endblock %}

{% block content %}
<div class="content_area">
  {% with user.get_profile.get_not_rated as order_list %}
  {% if order_list.exists %}
  <a id="notrated-link" href="#">{% trans 'You have not rated orders' %}</a>
  <div id="notrated-orders" style="display:none">
    <p><b>{% trans 'Orders that still need your feedback' %}</b></p>
    <ul>
      {% for order in order_list %}
      <li><a href="{% url order:feedback order.id %}">{{ order }}</a></li>
    {% endfor %}
    </ul>
  </div>{% endif %}
  {% endwith %}
  <div class="title"><h1 class="light_green">{% trans 'Restaurants' %}</h1></div>
  <div id="establishment_list">
    <table>
      <thead>
        <th>{% trans 'Unit' %}</th>
        <th>{% trans 'Quality' %}</th>
        <th>{% trans 'Delivery time' %}</th>
        <th>{% trans 'Comments' %}</th>
      </thead>
      <tbody>
      {% for unit in units %}
      <tr class="{{ unit.package.slug }}-unit {{ unit.schedule.is_open|yesno:',lock' }} {{ unit.is_new|yesno:'new-unit,' }} {% cycle 'even' 'odd'%}">
        <td><a href="{% url restaurant:detail unit.id %}">{{ unit }}</a></td>
        <td>{% if unit.avg_quality %}{{ unit.avg_quality|floatformat }}{% else %}{% trans 'N/A' %}{% endif %}</td>
        <td>{% if unit.avg_speed %}{{ unit.avg_speed|floatformat }}{% else %}{% trans 'N/A' %}{% endif %}</td>
        <td><a href="{% url restaurant:comments unit.id %}">{% trans 'Comments' %} ({{ unit.comment_count }})</a></td>
      </tr>
      {% endfor %}
      </tbody>
    </table>
  </div> <!-- establishment_list -->
</div> <!-- content_area -->
{% endblock %}
