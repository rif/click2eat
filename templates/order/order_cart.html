{% load i18n %}
{% load order_tags %}
<script type="text/javascript">

    $(function() {
        $(".add").click(function(e) {
            var selected_cart = "{{ cartname|slugify }}";
	    var item = $(this);
            $.get($(this).attr("href"), function(response) {
                item.parents(".cart-content").load("/order/get_cart/{{ order.id }}/" + selected_cart);
                getAvailableToppings();
            });
            e.preventDefault();
        });
        $(".sub").click(function(e) {
            var row = $(this).parents(".item");
	    var item = $(this);
            $.get($(this).attr("href"), function(resp) {
                if (resp == "nook") {
                    if(row.hasClass('master')) {
                        group = row.attr('group');
                        $("div[group|=" + group + "]").fadeOut();
                    } else {
                        row.fadeOut();
                    }
                    if (typeof getAvailableToppings == 'function') {
                        /* check if function is defined in this context*/
                        getAvailableToppings();
                    }
                } else {
                    $(".buc", row).text(resp + " x ");
                }
                $("#{{cartname|slugify}}_subtotal").load($("#{{cartname|slugify}}_subtotal").attr("href"));
		            $("#order-total-amount").load("{% url order:get_total_amount order.id %}");
            });
            e.preventDefault();
        });
    });
</script>

{% for oi in oil %}
{% if not oi.master %}
{% if oi.get_payload %}
<div class="item master" group="item-{{ oi.id }}">
  <div class="buc">{{ oi.count }} x </div>
  <div class="tip">{{ oi.get_payload.name_def }}</div>
  <div class="pret">{{ oi.old_price }} {% trans 'RON' %}</div>
  <a href="{% url order:remove_item oi.id %}" title="" class="sub"></a>
  <a href="{% url order:add_item oi.get_payload.id cartname|slugify %}" title="" class="add"></a>
</div>
{% if oi.orderitem_set.exists %}
{% for slave_oi in oi.orderitem_set.iterator %}
<div class="item topping-row" group="item-{{ oi.id }}">
  <div class="buc">{{ slave_oi.count }} x </div>
  <div class="tip">{{ slave_oi.get_payload.name_def }}</div>
  <div class="pret">{{ slave_oi.old_price }} {% trans 'RON' %}</div>
  <a href="{% url order:remove_item slave_oi.id %}" title="" class="sub"></a>
  <a href="{% url order:add_topping oi.get_payload.id slave_oi.get_payload.id cartname|slugify %}" title="" class="add"></a>
</div>
{% endfor %}
{% endif %}
{% endif %} <!-- oi.item -->
{% if oi.menu_of_the_day %}
<div class="item master" group="item-{{ oi.id }}">
  <div class="buc">{{ oi.count }} x </div>
  <div class="tip">{{ oi.menu_of_the_day.name }}</div>
  <div class="pret">{{ oi.old_price }} {% trans 'RON' %}</div>
  <a href="{% url order:remove_item oi.id %}" title="" class="sub"></a>
  <a href="{% url order:add_motd oi.get_payload.id cartname|slugify %}" title="" class="add"></a>
</div>
{% endif %}
{% endif %}
{% empty %}
<tr>
  <td class="placeholder">{% trans 'Click menu items to fill the cart' %}</td>
</tr>
{% endfor %}
<br/>
<div class="subtotal">
{% trans 'Subtotal' %}: <span id="{{cartname|slugify}}_subtotal"
                              href="{% url order:get_subtotal order.unit.id cartname|slugify %}">{% get_cart_subtotal %}</span>
</div>

