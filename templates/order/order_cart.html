{% load i18n %}
{% load order_tags %}
<script type="text/javascript">

$(function(){
  $(".add-orderitem").click(function(e){
      var selected_cart = "{{ cartname }}";
      $.get($(this).attr("href"), function(response){
          $(".css-panes>div").load("/order/get_cart/{{ order.id }}/" + selected_cart);
          getAvailableToppings();
        });
        e.preventDefault();
  });
  $(".remove-orderitem").click(function(e){
    var row = $(this).parents("tr");
    $.get($(this).attr("href"), function(resp){
       if(resp=="nook") {
          row.fadeOut();
          if(typeof getAvailableToppings == 'function') {
            /* check if function is defined in this context*/
             getAvailableToppings();
          }
       } else{
          $(".count", row).text(resp);
       }
       $("#{{cartname}}_subtotal").load($("#{{cartname}}_subtotal").attr("href"));
    });
    e.preventDefault();
  });
})
</script>
<div id="current_order">
  <table id="cart-{{ cartname }}-table"> 
    <tr class="header"> 
      <th class="item">{% trans 'Item' %}</th> 
      <th class="count">{% trans 'Count' %}</th> 
      <th class="price">{% trans 'Price' %}</th> 
    </tr> 
    {% for oi in oil %}
    <tr class="{% cycle 'odd' 'even' %}"> 
      <td class="item">{{ oi.item.name_def }}</td> 
      <td class="count">{{ oi.count }}</td> 
      <td class="price">{{ oi.old_price }}</td>
      <td class="minus"><a class="remove-orderitem" href="{% url order:remove_item oi.id %}">
	  <img alt="-" src="{{ MEDIA_URL }}images/template/plate_minus_btn.png">
      </a></td>
      <td class="plus"><a class="plus add-orderitem" href="{% url order:add_item oi.item.id cartname %}">
	  <img alt="+" src="{{ MEDIA_URL }}images/template/plate_plus_btn.png">
      </a></td>
    </tr> 
    {% empty %}
    <tr> 
      <td class="placeholder">{% trans 'Click menu items to fill the plate' %}</td> 
    </tr>
    {% endfor %}
  </table> 
</div> <!-- current_order -->

{% trans 'Subtotal' %}: <span id="{{cartname}}_subtotal" href="{% url order:get_subtotal order.unit.id cartname %}">{% get_cart_subtotal %}</span>


