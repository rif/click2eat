{% load i18n %}
{% load order_tags %}

<script type="text/javascript">
$(function(){
  $(".remove-orderitem").click(function(e){
    var row = $(this).parents("tr");
    $.get($(this).attr("href"), function(resp){
       if(resp=="nook") {
          row.fadeOut();
          if(typeof getAvailableToppings == 'function') {
            /* check if function is defined in this context*/
             getAvailableToppings();
          }
       } else{
          $(".count-td", row).text(resp);
       }
       $("#order-total-amount").load("{% url order:get_total_amount order.id %}");
       $("#cart-subtotal-amount").load($("#cart-subtotal-amount").attr("href"));
    });
    e.preventDefault();
  });
})
</script>

<div class="content_area">
  <div class="title"><h1 class="light_orange">{% trans 'Order details' %}</h1></div>
  <ul>
    <li>{% trans 'Unit' %}: {{ order.unit }}</li>
    <li>{% trans 'Creation date' %}: {{ order.creation_date }}</li>
    <li>{% trans 'Status' %}: {{ order.get_status_display }}</li>
    <li>{% trans 'Total amount' %}: {{ order.total_amount }}</li>
  </ul>
</div> <!-- content_area -->

<div class="content_area">
  <div class="title"><h1 class="light_orange">{% trans 'Order Items' %}</h1></div>
  <div id="cart"> 
    <h1>{% trans 'Cart items' %}</h1> 
    {% for cartname, oil in order.get_carts.items %}
    <table>
      <tr> 
	<th>{{ cartname }}</th> 
	<th></th>
	<th></th>
	<th class="del"><a href="#" title="" target="_self"><img src="{{ MEDIA_URL }}images/template/cart_delete_btn.png" alt="Delete cart"></a></th> 
      </tr> 
      {% for oi in oil %}
      <tr>
        <td class="item">{{ oi.item.name_def }}</td>
	<td class="count-td">{{ oi.count }}</td>
        <td class="price">{{ oi.old_price }}</td>
        <td>
	<td class="del">{% if order.status == 'CR' %}<a class="remove-orderitem" href="{% url order:remove_item oi.id %}" title="" target="_self"><img src="{{ MEDIA_URL}}images/template/cart_delete_btn.png" alt="{% trans 'Remove' %}"></a>{% endif %}</td> 
      </tr> 
      {% empty %}
      <tr>{% trans 'There are no order items for' %} {{cartname}}</tr>
      {% endfor %}
      <tr> 
	<td class="total">{% trans 'Subtotal' %}</td> 
	<td></td> 
	<td class="total"><span id="cart-subtotal-amount" href="{% url order:get_subtotal order.unit.id cartname %}">{% get_cart_subtotal %}<span></td> 
	<td></td> 
      </tr> 	
    </table>
    {% cycle '' '' '<div class="clear"></div>' %}
    {% endfor %}
    <h1>{% trans 'Total amount' %} <span id="order-total-amount">{{ order.total_amount }}</span></h1>
  </div> <!-- cart -->
</div> <!-- content_area -->
